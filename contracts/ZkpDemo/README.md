# ZkpDemo 

## Abstract

[ZkpDemo.ts](./contract/ZkpDemo.ts) 提供简单的验证verify zero knowledge proof 示例.

## Contract Interface


- 设置verify key
- 方法名`setVerifyKey`
- 函数定义
  ` setVerifyKey(bid: u64, key: string): void`
- 参数说明

| Filed | Type | Description|
|------|------|--------|
|bid|u64| business id|
|key|string| verify key|

Format of verify key:
vk_alfabeta_12
vk_gamma_2
vk_delta_2
IC_size
IC[0]
IC[1]
...
IC[IC_size-1]
---

- 验证零知识证明
- 方法名 `testZkp`
- 函数定义
  `testZkp(caseid: u64, bid: u64, pk_input: string, proof: string, expect: i32): void;`
- 参数说明

| Filed | Type | Description|
|------|------|--------|
|caseid|u64| test case id, with which to save the verifying result|
|bid|u64| business id|
|pk_input|string| primary input key|
|proof |string| proof |
|expect| i32 | expect value, 1表示true， 0 表示false|

Format of primary input key:
IC_size
publicSignals[0]
...
publicSignals[IC_size-1]

Format of proof:
pi_a
pi_b
pi_c

## Test
1. deploy contract
```
$clu set contract root2 ~/ZkpDemo -p root2
```
2. 调用合约`setVerifyKey`方法设置verify key，可以用业务id来区分不同业务的key，下述例子中的id是个随机数
```
$clu push action root2 setVerifyKey '[834723498319,"10008410524823016685432075091170689420523928115990748195734102145300204434959 2744901506663581673359641711212346323565451440948915633373241609337554403303 1963704402179736640852450409194961659426526983006999767896030763389367764217 15450741145373083215559930233366247519620986566992038008091129529110830649746 17917631013102796696813626059084489394034199012643745991453903727123983020776 7177785775392137106246998667685580992957673286316730921841567743190524800301 14203450583619548205350724442067492446185182246633980381027454127512679243536 18814970596685931800873181913179278886663804665343867762143938457826522252954 15644769198430448258813286611521896164500122571517255288608992288629353773839 6910940080692937772238920793253953679048390178651074635147400853482597228862 14133465881088820802776421217989899979523690995109011042705741419941197977713 18112152037103813859693743195070507793163530783520550231045610688837322163068  12470797375341519504898855965477613676775860780269142434023357462853584485740 10373904063888970346151547178658745467959194536227441593837828102830179409260 20736468389090033388431415507029187894515719375429659917009235787243596910814 12325977018363016490693387446130702028138138962322718997618144135777039252746  1549199366107197982255162199009231774320082505704552261530790110189239872818 1347131320349572958764027013793287038828315833040936639691002787948622373652 17355183030385026012170849121540048195115473098090992068693895946883381875876 402310010974956301900709977484808014650053692656473065085268386523362585434  16764327323735027609152795989735356005143475466880988305661828008942167456788 10587575761542468556694635882537698676987402547174328152190116990740979980450 1 16259498619181264167008250469909395053844016254040059919843286605707469586706 21469954148923259576766676422348321937308083085606333815985850158407071930206"]' -p root2
```

3. 调用合约testZkp方法来验证零知识证明，如果期待输出和实际输出不一致就会报错，caseid用来区分第几次测试结果。
```
$clu push action root2 testZkp '[1,834723498319,"1 3176017887"," 3272772948874660232072949349131651726938249937757569694511653605628973511250 21322169478256701634189049753496530386336751902612709877592573591150749111219  14516637591323967450770315265831306807644984945721761592573786642909038906708 6678636639043845611737270917308751397710156307404126118932355763222436550128 16840258341655633415145866452115008398462006600998748978901726344633077384979 17791116673896031944335570014335418950710485348797223100649440766238146767989  12572540161237526022821151465351301445199689000633969490696622032476710410509 6901859865338738276488353208873749895096241818564188626456910265586223704470", 1]' -p root2
```

### Tips
- 合约部署和调用可以使用u3.js,以上是使用ultrain-core命令行
- u3.js使用请参考[开发者文档](https://developer.ultrain.io/documents)
